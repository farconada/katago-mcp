# =============================================================================
# KataGo Analysis Configuration - Optimizado para RTX 3090
# =============================================================================
# Este archivo está configurado para aprovechar al máximo la RTX 3090 (24GB VRAM)
# Usa este archivo con: katago analysis -config analysis.cfg -model <modelo>
# =============================================================================

# -----------------------------------------------------------------------------
# Configuración de GPU / CUDA
# -----------------------------------------------------------------------------

# Número de hilos del servidor de red neuronal por modelo
# RTX 3090 puede manejar 2-4 hilos eficientemente
numNNServerThreadsPerModel = 2

# Qué GPU usar (0 = primera GPU, 1 = segunda, etc.)
# Si tienes múltiples GPUs, cambia este valor
cudaDeviceToUse = 0

# Usar FP16 (half precision) para inferencia más rápida
# RTX 3090 tiene excelente rendimiento en FP16 con Tensor Cores
cudaUseFP16 = true

# Usar formato NHWC (más rápido en GPUs modernas con Tensor Cores)
cudaUseNHWC = true

# -----------------------------------------------------------------------------
# Configuración de Búsqueda MCTS
# -----------------------------------------------------------------------------

# Número de hilos de búsqueda
# RTX 3090 puede alimentar muchos hilos simultáneos
# 8-16 es un buen rango para análisis
numSearchThreads = 12

# Tamaño del batch para la red neuronal
# Mayor = más eficiente en GPU, pero más latencia
# RTX 3090 con 24GB puede manejar batches grandes
nnMaxBatchSize = 64

# Cache de la red neuronal (en número de posiciones)
# Con 24GB de VRAM, podemos usar un cache grande
nnCacheSizePowerOfTwo = 23

# Mutex pool para el cache (potencia de 2)
nnMutexPoolSizePowerOfTwo = 17

# -----------------------------------------------------------------------------
# Configuración de Análisis
# -----------------------------------------------------------------------------

# Máximo de visitas para análisis (puede ser sobrescrito por query)
maxVisits = 500

# Longitud de las variaciones principales a reportar
analysisPVLen = 15

# Ruido en la raíz para exploración más amplia
# Útil para ver más variaciones alternativas
analysisWideRootNoise = 0.04

# Reportar análisis como winrates desde la perspectiva de...
# BLACK = siempre desde negro, SIDETOMOVE = desde quien juega
reportAnalysisWinratesAs = SIDETOMOVE

# -----------------------------------------------------------------------------
# Comportamiento del Motor
# -----------------------------------------------------------------------------

# No hacer ruido en la búsqueda (análisis puro, no juego)
rootNumSymmetriesToSample = 8

# Ignorar posiciones pasadas para ko/superko
ignoreExternalHistory = false

# Número máximo de movimientos para la historia de hash
hashTableMaxHistoryLength = 100

# -----------------------------------------------------------------------------
# Poda y Optimizaciones
# -----------------------------------------------------------------------------

# Factor de utilidad para poda de movimientos
# Más bajo = más agresivo, pero puede perder movimientos buenos
# Para análisis, es mejor ser conservador
fpuReductionMax = 0.2
fpuLossProp = 0.0

# Factor de exploración PUCT
cpuctExploration = 1.0
cpuctExplorationLog = 0.45

# -----------------------------------------------------------------------------
# Logging (deshabilitado para MCP server)
# -----------------------------------------------------------------------------

# No log de información de búsqueda (reduce ruido en stderr)
logSearchInfo = false
logMoves = false
logGamesEvery = 0
logToStderr = false

# -----------------------------------------------------------------------------
# Configuración de Territorio/Ownership
# -----------------------------------------------------------------------------

# Incluir análisis de territorio en las respuestas
# (Puede ser sobrescrito por query)
# El servidor MCP usa includeOwnership en las queries individuales

# -----------------------------------------------------------------------------
# Notas de Rendimiento RTX 3090
# -----------------------------------------------------------------------------
# Con esta configuración deberías obtener:
# - ~1000-3000 visitas/segundo dependiendo del modelo
# - Latencia de análisis < 1 segundo para 100 visitas
# - Uso de VRAM: ~2-6GB dependiendo del modelo
#
# Modelos recomendados para RTX 3090:
# - b18c384nbt (más fuerte, ~4GB VRAM)
# - b40c256    (muy fuerte, ~6GB VRAM)  
# - b6c96      (más rápido, ~1GB VRAM, para análisis rápido)
#
# Si experimentas problemas de memoria, reduce:
# - nnMaxBatchSize a 32
# - nnCacheSizePowerOfTwo a 21
# - numSearchThreads a 8
# =============================================================================